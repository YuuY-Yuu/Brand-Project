<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ„ è–èª•å°Šæ¦®å“ç‰ŒæŸ¥è©¢ç³»çµ± - AI æ™ºèƒ½æœå°‹ç‰ˆ</title>
    <style>
        /* ================= åŸºç¤æ¨£å¼ ================= */
        body { font-family: 'Times New Roman', 'Microsoft JhengHei', serif; background-color: #fff0f0; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; margin: 0; padding: 40px 0; }
        .container { background: white; padding: 2.5rem; border-radius: 20px; box-shadow: 0 10px 40px rgba(176, 0, 32, 0.1); width: 90%; max-width: 1000px; position: relative; border-top: 8px solid #B00020; }
        
        h2 { text-align: center; color: #B00020; font-family: 'Georgia', serif; font-size: 2.2rem; margin-bottom: 2rem; border-bottom: 2px solid #FFD700; padding-bottom: 15px; }
        h3 { color: #B00020; margin-top: 0; font-size: 1.4rem; margin-bottom: 15px; }

        /* ================= è¼ªæ’­æ¨£å¼ ================= */
        .carousel-section { margin-bottom: 3rem; overflow: hidden; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.15); }
        .carousel-container { display: flex; transition: transform 0.8s ease-in-out; width: 100%; }
        .carousel-card { min-width: 100%; height: 280px; flex-shrink: 0; background-size: cover; background-position: center; color: white; padding: 40px; box-sizing: border-box; display: flex; flex-direction: column; justify-content: flex-end; text-shadow: 0 2px 10px rgba(0, 0, 0, 0.8); }
        
        /* èƒŒæ™¯åœ– (ä½¿ç”¨è–èª•é¢¨æ ¼åœ–åº«) */
        .card-bg-1 { background-image: linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1544979590-37e26a6cd737?auto=format&fit=crop&w=1000&q=80'); }
        .card-bg-2 { background-image: linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1512389142860-9c449e58a543?auto=format&fit=crop&w=1000&q=80'); }
        .card-bg-3 { background-image: linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1513297887119-d46091b24bfa?auto=format&fit=crop&w=1000&q=80'); }
        .card-bg-4 { background-image: linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1576694040870-15938006b023?auto=format&fit=crop&w=1000&q=80'); }

        /* ================= æœå°‹æ¡†æ¨£å¼ ================= */
        .search-box { background: #fffbf0; padding: 25px; border-radius: 15px; margin-bottom: 30px; border: 1px solid #FFD700; }
        .search-row { display: flex; gap: 15px; align-items: flex-end; flex-wrap: wrap; }
        .input-group { flex: 1; min-width: 200px; position: relative; }
        label { display: block; margin-bottom: 8px; color: #555; font-weight: bold; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; outline: none; }
        input:focus, select:focus { border-color: #B00020; }

        /* æŒ‰éˆ• */
        .btn-group { display: flex; gap: 10px; }
        button { padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; transition: 0.3s; display: flex; align-items: center; justify-content: center; }
        .btn-search { background-color: #B00020; color: white; }
        .btn-search:hover { background-color: #8C0018; transform: translateY(-2px); }
        .btn-ai { background-color: #FFD700; color: #B00020; }
        .btn-ai:hover { background-color: #f7c600; transform: translateY(-2px); }

        /* æ¸…é™¤æŒ‰éˆ• X */
        .clear-btn { position: absolute; right: 12px; top: 40px; background: #ddd; color: white; width: 22px; height: 22px; border-radius: 50%; text-align: center; line-height: 22px; cursor: pointer; display: none; font-size: 14px; }
        .clear-btn:hover { background: #B00020; }

        /* ================= æœå°‹çµæœå¡ç‰‡ (é‡é»æ¨£å¼) ================= */
        .card-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; margin-top: 25px; }
        
        .result-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-left: 6px solid #B00020; /* è–èª•ç´…å·¦é‚Šæ¢ */
            padding: 20px;
            transition: 0.3s;
            position: relative;
            overflow: hidden;
        }
        .result-card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
        .result-card h4 { margin: 0 0 10px 0; color: #B00020; font-size: 1.3rem; display: flex; align-items: center; gap: 8px; }
        .result-card .info { color: #555; font-size: 0.95rem; margin: 5px 0; }
        .result-card .match-box {
            background: #fff5f5;
            padding: 10px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px dashed #B00020;
        }
        .result-card .match-title { font-weight: bold; color: #B00020; font-size: 0.9rem; margin-bottom: 5px; }
        .brand-tag { 
            display: inline-block; 
            background: #FFD700; 
            color: #B00020; 
            padding: 2px 8px; 
            border-radius: 4px; 
            font-size: 0.85rem; 
            font-weight: bold; 
            margin-right: 5px; 
            margin-bottom: 5px;
        }
        
        /* æ¨“å±¤å°è¦½è¦–çª— */
        #floorView { display: none; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .floor-row { display: flex; border-bottom: 1px solid #eee; padding: 12px 0; }
        .floor-num { width: 50px; font-weight: bold; color: #B00020; }
        .floor-brands { flex: 1; color: #444; }

        /* ================= AI è¦–çª— ================= */
        #aiModal { display: none; position: fixed; bottom: 20px; right: 20px; width: 360px; height: 520px; background: white; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); z-index: 1000; flex-direction: column; border: 3px solid #FFD700; overflow: hidden; }
        .ai-header { background: #B00020; color: white; padding: 15px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        .ai-body { flex: 1; padding: 15px; overflow-y: auto; background: #fffcfc; display: flex; flex-direction: column; gap: 12px; }
        .ai-footer { padding: 10px; border-top: 1px solid #eee; display: flex; gap: 8px; background: white; }
        
        .msg { padding: 10px 14px; border-radius: 15px; max-width: 85%; font-size: 0.95rem; line-height: 1.4; word-wrap: break-word; }
        .msg-ai { background: #f0f0f0; color: #333; align-self: flex-start; border-bottom-left-radius: 2px; }
        .msg-user { background: #B00020; color: white; align-self: flex-end; border-bottom-right-radius: 2px; }
        
    </style>
</head>
<body>

<div class="container" id="mainView">
    <h2>âœ¨ å“ç‰Œé–€å¸‚ç²¾é¸æŸ¥è©¢</h2>

    <div class="carousel-section">
        <div id="autoCarousel" class="carousel-container">
            <div class="carousel-card card-bg-1"><h4>é ç™¾ä¿¡ç¾© A13 | è–èª•å¥‡å¹»ä¹‹æ—…</h4><p>ğŸ å„ªæƒ ï¼šç²¾å“é™æ™‚æŠ˜æ‰£ï¼Œæ»¿é¡é€ç¦®ç›’ï¼</p></div>
            <div class="carousel-card card-bg-2"><h4>æ–°å…‰ä¸‰è¶Š é‘½çŸ³å¡” | ç’€ç’¨æ˜Ÿå…‰ç››å®´</h4><p>ğŸ›ï¸ ç‰¹è‰²ï¼šå…¨å°ç¨å®¶è–èª•æ¨¹é€ æ™¯ï¼</p></div>
            <div class="carousel-card card-bg-3"><h4>SOGO å¿ å­é¤¨ | è€¶èª•æš–å¿ƒç»ç¦®</h4><p>ğŸ„ æ¨è–¦ï¼šå¡å‹ç¨äº«ç‰¹å®šå“ç‰Œ 9 æŠ˜ï¼</p></div>
            <div class="carousel-card card-bg-4"><h4>å¾®é¢¨å—å±± | å¥¢è¯è·¨å¹´æ´¾å°</h4><p>ğŸ¥‚ æ¨è–¦ï¼šé ‚æ¨“é…’å§è·¨å¹´å¥—ç¥¨é–‹è³£ï¼</p></div>
        </div>
    </div>

    <div class="search-box">
        <h3>ğŸ” æ‰¾å“ç‰Œ / æ‰¾ç™¾è²¨</h3>
        <div class="search-row">
            <div class="input-group" style="flex: 0.4;">
                <label>é¸æ“‡åœ°å€</label>
                <select id="citySelect">
                    <option value="All">å…¨å°æœå°‹</option>
                    <option value="Taipei">è‡ºåŒ—</option>
                    <option value="NewTaipei">æ–°åŒ—</option>
                    <option value="NewTaipei">æ¡ƒåœ’</option>
         
                </select>
            </div>
            <div class="input-group" style="flex: 1.2;">
                <label>è¼¸å…¥å“ç‰Œ (å¯è¼¸å…¥å¤šå€‹ï¼Œä¾‹å¦‚: Nike, Adidas)</label>
                <input type="text" id="brandInput" placeholder="è¼¸å…¥å“ç‰Œåç¨±..." oninput="checkInput()">
                <div id="clearBtn" class="clear-btn" onclick="clearInput()">âœ•</div>
            </div>
            <div class="btn-group">
                <button class="btn-search" onclick="smartSearch()">ç«‹å³æŸ¥è©¢</button>
                <button class="btn-ai" onclick="toggleAI()">ğŸª„ AI è©¢å•</button>
            </div>
        </div>
        
        <div id="resultArea" class="card-container"></div>
    </div>
</div>

<div class="container" id="floorView">
    <button class="btn-search" style="background:#666; margin-bottom: 20px; padding: 8px 15px;" onclick="closeFloorView()">â† è¿”å›æœå°‹çµæœ</button>
    <h2 id="floorTitle" style="margin-bottom: 10px; border:none;">ç™¾è²¨åç¨±</h2>
    <p id="floorSubtitle" style="text-align:center; color:#666; margin-bottom: 25px;"></p>
    <div id="floorList" style="border-top: 2px solid #FFD700;"></div>
</div>

<div id="aiModal">
    <div class="ai-header">
        <span>ğŸ¤– è–èª•è³¼ç‰© AI é¡§å•</span>
        <span style="cursor:pointer; font-size:1.2rem;" onclick="toggleAI()">âœ•</span>
    </div>
    <div class="ai-body" id="aiChatBody">
        <div class="msg msg-ai">ä½ å¥½ï¼æˆ‘æ˜¯è–èª• AI é¡§å• ğŸ…<br>æˆ‘å¯ä»¥å¹«æ‚¨æŸ¥è©¢å“ç‰Œåœ¨å“ªäº›ç™¾è²¨æœ‰æ«ƒä½ï¼Œæˆ–æ˜¯æ¨è–¦å¥½åƒçš„é¤å»³å–”ï¼<br><br>è©¦è©¦å•æˆ‘ï¼šã€Œå“ªè£¡æœ‰ Nikeï¼Ÿã€æˆ–ã€ŒA13 æœ‰ä»€éº¼å¥½åƒçš„ï¼Ÿã€</div>
    </div>
    <div class="ai-footer">
        <input type="text" id="aiInput" placeholder="è¼¸å…¥å•é¡Œ..." onkeypress="if(event.key==='Enter') sendAiMsg()">
        <button class="btn-search" style="padding: 8px 15px;" onclick="sendAiMsg()">é€å‡º</button>
    </div>
</div>

<script>
    // ==========================================
    // 1. è³‡æ–™åº« (æ¨¡æ“¬å¾Œç«¯è³‡æ–™)
    // ==========================================
    const mallData = [
        {
            id: "m1", city: "Taipei", name: "é ç™¾ä¿¡ç¾© A13", 
            desc: "4F æ‡·èˆŠè€è¡—èˆ‡ Apple æ——è‰¦åº—",
            address: "å°åŒ—å¸‚ä¿¡ç¾©å€æ¾ä»è·¯58è™Ÿ",
            floors: {
                "B3": ["é£Ÿä»£é¤¨", "æ¨‚æ³•", "å³å¯¶æ˜¥"],
                "1F": ["Apple", "é¼æ³°è±", "Lady M"],
                "4F": ["æ‡·èˆŠé£Ÿä»£", "é ‚å‘±å‘±", "æ˜¥æ°´å ‚"],
                "6F": ["Nike", "Adidas", "Puma", "Under Armour"], // é€™è£¡åŒæ™‚æœ‰ Nike, Adidas
                "14F": ["Hooters", "æ–°é¦¬è¾£", "éŸ¿é£Ÿå¤©å ‚"]
            }
        },
        {
            id: "m2", city: "Taipei", name: "æ–°å…‰ä¸‰è¶Š é‘½çŸ³å¡”",
            desc: "æ±å€æœ€æ–°åœ°æ¨™ï¼Œç²¾å“èˆ‡ç±³å…¶æ—é¤é£²",
            address: "å°åŒ—å¸‚å¤§å®‰å€å¿ å­æ±è·¯ä¸‰æ®µ268è™Ÿ",
            floors: {
                "1F": ["Dior", "Burberry", "Loewe"],
                "2F": ["Aesop", "10/10 HOPE"],
                "3F": ["Simple Kaffa", "æ½®æµé¸ç‰©"],
                "4F": ["Restaurant A", "åˆé­š"]
            }
        },
        {
            id: "m3", city: "Taipei", name: "SOGO å¿ å­é¤¨",
            desc: "ç¾å¦å¤©åå®®ï¼Œåœ°éµç›´é”",
            address: "å°åŒ—å¸‚å¤§å®‰å€å¿ å­æ±è·¯å››æ®µ45è™Ÿ",
            floors: {
                "B1": ["é¼æ³°è±", "è¶…å¸‚", "è©©ç‰¹è‰"],
                "1F": ["Chanel", "EstÃ©e Lauder", "Jo Malone"],
                "10F": ["Nike", "Adidas", "New Balance"], // é€™è£¡ä¹ŸåŒæ™‚æœ‰
                "11F": ["èšåŒ—æµ·é“é‹ç‰©", "ä¸‰åˆé™¢"]
            }
        },
        {
            id: "m4", city: "NewTaipei", name: "æ¿æ©‹å¤§é ç™¾",
            desc: "æ–°åŒ—æœ€å¥¢è¯ï¼Œå¨å°¼æ–¯äººé€ æ™¯",
            address: "æ–°åŒ—å¸‚æ¿æ©‹å€æ–°ç«™è·¯28è™Ÿ",
            floors: {
                "B1": ["é¼æ³°è±", "æ·»å¥½é‹", "Godiva"],
                "1F": ["Gucci", "Coach", "YSL"],
                "6F": ["Nike", "Adidas Originals", "Fila"], // é€™è£¡ä¹ŸåŒæ™‚æœ‰
                "9F": ["éå¸¸æ³°", "é‡‘è‰²ä¸‰éº¥", "è—å±‹"]
            }
        },
        {
            id: "m5", city: "NewTaipei", name: "å®åŒ¯å»£å ´",
            desc: "æ–°èŠæœ€å¤§è³¼ç‰©ä¸­å¿ƒï¼ŒVR æ¨‚åœ’",
            address: "æ–°åŒ—å¸‚æ–°èŠå€æ–°åŒ—å¤§é“å››æ®µ3è™Ÿ",
            floors: {
                "1F": ["Volvo", "Starbucks"],
                "4F": ["Nike", "Skechers"], // åªæœ‰ Nike
                "7F": ["è—å£½å¸", "ç‡’è‚‰LIKE"]
            }
        }
    ];

    // ==========================================
    // 2. æœå°‹æ ¸å¿ƒé‚è¼¯ (å¤šå“ç‰Œäº¤é›† & é¡¯ç¤º)
    // ==========================================
    function smartSearch() {
        const cityFilter = document.getElementById('citySelect').value;
        const inputStr = document.getElementById('brandInput').value.trim();
        const resultArea = document.getElementById('resultArea');
        resultArea.innerHTML = ""; // æ¸…ç©ºèˆŠçµæœ

        // æ­¥é©Ÿ 1: è§£æè¼¸å…¥çš„å“ç‰Œ (ä¾‹å¦‚: "Nike, Adidas" -> ["nike", "adidas"])
        let searchBrands = [];
        if (inputStr) {
            searchBrands = inputStr.toLowerCase().split(/[\s,ï¼Œã€]+/).filter(Boolean);
        }

        // æ­¥é©Ÿ 2: ç¯©é¸ç¬¦åˆæ¢ä»¶çš„ç™¾è²¨
        let matches = mallData.filter(mall => {
            // å…ˆéæ¿¾ç¸£å¸‚
            if (cityFilter !== "All" && mall.city !== cityFilter) return false;

            // å¦‚æœæ²’è¼¸å…¥å“ç‰Œï¼Œå°±é¡¯ç¤ºè©²ç¸£å¸‚æ‰€æœ‰ç™¾è²¨
            if (searchBrands.length === 0) return true;

            // å¦‚æœæœ‰è¼¸å…¥å“ç‰Œï¼Œæª¢æŸ¥è©²ç™¾è²¨æ˜¯å¦"åŒæ™‚åŒ…å«"æ‰€æœ‰è¼¸å…¥çš„å“ç‰Œ (Intersection)
            // æˆ‘å€‘æŠŠè©²ç™¾è²¨æ‰€æœ‰æ¨“å±¤çš„å“ç‰Œåˆä½µæˆä¸€å€‹å¤§å­—ä¸²ä¾†æª¢æŸ¥
            const allBrandsInMall = Object.values(mall.floors).flat().map(b => b.toLowerCase());
            
            // æª¢æŸ¥æ˜¯å¦æ¯ä¸€å€‹æœå°‹çš„å“ç‰Œéƒ½åœ¨é€™å€‹ç™¾è²¨è£¡
            return searchBrands.every(keyword => 
                allBrandsInMall.some(dbBrand => dbBrand.includes(keyword))
            );
        });

        // æ­¥é©Ÿ 3: æ¸²æŸ“çµæœå¡ç‰‡
        if (matches.length === 0) {
            resultArea.innerHTML = `<div style="grid-column: 1/-1; text-align:center; color:#888; padding:30px;">
                <h4>ğŸ¤·â€â™‚ï¸ å“å‘€ï¼Œæ‰¾ä¸åˆ°ç¬¦åˆçš„çµæœ</h4>
                <p>è©¦è©¦çœ‹æœå°‹å–®ä¸€å“ç‰Œï¼Œæˆ–æ˜¯åˆ‡æ›ç¸£å¸‚ç¯„åœã€‚</p>
            </div>`;
            return;
        }

        matches.forEach(mall => {
            // æ‰¾å‡ºæœå°‹åˆ°çš„å“ç‰Œåˆ†åˆ¥åœ¨å“ªä¸€æ¨“ (ç‚ºäº†é¡¯ç¤ºåœ¨å¡ç‰‡ä¸Š)
            let brandLocationsHtml = "";
            if (searchBrands.length > 0) {
                let locationDetails = [];
                
                // éæ­·è©²ç™¾è²¨æ¨“å±¤ï¼Œæ‰¾å‡ºå°æ‡‰å“ç‰Œ
                for (const [floor, brandsOnFloor] of Object.entries(mall.floors)) {
                    brandsOnFloor.forEach(realBrandName => {
                        // æª¢æŸ¥é€™å€‹çœŸå¯¦å“ç‰Œåç¨±æ˜¯å¦åŒ¹é…ä½¿ç”¨è€…çš„æœå°‹é—œéµå­—
                        searchBrands.forEach(userKey => {
                            if (realBrandName.toLowerCase().includes(userKey)) {
                                locationDetails.push(`<span class="brand-tag">${realBrandName} (${floor})</span>`);
                            }
                        });
                    });
                }
                
                // å»é™¤é‡è¤‡ (ä¾‹å¦‚æŸç‰Œåœ¨å¤šæ¨“å±¤) ä¸¦çµ„åˆæˆ HTML
                locationDetails = [...new Set(locationDetails)]; 
                brandLocationsHtml = `
                    <div class="match-box">
                        <div class="match-title">ğŸ‰ æ‰¾åˆ°ä»¥ä¸‹å“ç‰Œï¼š</div>
                        <div>${locationDetails.join('')}</div>
                    </div>
                `;
            }

            // å»ºç«‹å¡ç‰‡ HTML
            const card = document.createElement('div');
            card.className = 'result-card';
            card.innerHTML = `
                <h4>ğŸ„ ${mall.name}</h4>
                <p class="info">ğŸ“ ${mall.address}</p>
                <p class="info" style="font-style:italic; color:#777;">${mall.desc}</p>
                ${brandLocationsHtml}
                <button class="btn-search" style="margin-top:15px; width:100%; font-size:0.9rem;" onclick="showFloorPlan('${mall.id}')">
                    æŸ¥çœ‹å®Œæ•´æ¨“å±¤
                </button>
            `;
            resultArea.appendChild(card);
        });
    }

    // ==========================================
    // 3. AI æ™ºèƒ½é‚è¼¯ (ä¸å†äº‚å›ç­”ï¼Œè€Œæ˜¯æŸ¥è³‡æ–™)
    // ==========================================
    function sendAiMsg() {
        const input = document.getElementById('aiInput');
        const body = document.getElementById('aiChatBody');
        const userQ = input.value.trim().toLowerCase();
        
        if (!userQ) return;

        // é¡¯ç¤ºä½¿ç”¨è€…è¨Šæ¯
        body.innerHTML += `<div class="msg msg-user">${input.value}</div>`;
        input.value = '';
        body.scrollTop = body.scrollHeight;

        // æ¨¡æ“¬ AI æ€è€ƒå»¶é²
        setTimeout(() => {
            let reply = "";

            // --- AI é‚è¼¯é–‹å§‹ ---
            
            // 1. æª¢æŸ¥æ˜¯å¦æœ‰å•ã€Œå“ç‰Œã€ (éæ­·è³‡æ–™åº«æ‰¾å“ç‰Œ)
            let foundMalls = [];
            let targetBrand = "";
            
            // ç°¡å–®æ–·è©ï¼Œæª¢æŸ¥è³‡æ–™åº«ä¸­çš„æ‰€æœ‰å“ç‰Œæ˜¯å¦å‡ºç¾åœ¨å•å¥ä¸­
            const allKnownBrands = new Set();
            mallData.forEach(m => Object.values(m.floors).flat().forEach(b => allKnownBrands.add(b)));
            
            allKnownBrands.forEach(b => {
                if (userQ.includes(b.toLowerCase())) {
                    targetBrand = b;
                }
            });

            if (targetBrand) {
                // å¦‚æœå•å¥åŒ…å«å“ç‰Œï¼Œå»è³‡æ–™åº«æœ
                mallData.forEach(m => {
                    for(const [floor, brands] of Object.entries(m.floors)) {
                        if (brands.some(bb => bb.toLowerCase().includes(targetBrand.toLowerCase()))) {
                            foundMalls.push(`<b>${m.name}</b> çš„ ${floor}`);
                        }
                    }
                });
                if (foundMalls.length > 0) {
                    reply = `å¹«æ‚¨æŸ¥åˆ°äº†ï¼<br>âœ¨ <b>${targetBrand}</b> åœ¨ä»¥ä¸‹åœ°é»æœ‰æ«ƒä½ï¼š<br>â€¢ ${foundMalls.join('<br>â€¢ ')}`;
                } else {
                    reply = `é›–ç„¶æˆ‘çŸ¥é“ ${targetBrand} é€™å€‹å“ç‰Œï¼Œä½†ç›®å‰è³‡æ–™åº«ä¸­çš„ç™¾è²¨ä¼¼ä¹æ²’æœ‰ç™»éŒ„å®ƒçš„æ«ƒä½è³‡è¨Šã€‚`;
                }
            } 
            // 2. æª¢æŸ¥é—œéµå­— (åƒã€æ¨è–¦)
            else if (userQ.match(/åƒ|é¤å»³|ç¾é£Ÿ|é¤“/)) {
                // éš¨æ©Ÿæ¨è–¦ä¸€é–“æœ‰é¤å»³çš„ç™¾è²¨
                const foodMall = mallData[0]; // ç¯„ä¾‹å– A13
                reply = `æƒ³åƒç¾é£Ÿå—ï¼ŸğŸ½ï¸<br>æ¨è–¦æ‚¨å» <b>${foodMall.name}</b>ï¼<br>B3 æœ‰é£Ÿä»£é¤¨ç¾é£Ÿè¡—ï¼Œ14F æœ‰æ·±å¤œé£Ÿå ‚ï¼Œéå¸¸é©åˆè–èª•èšé¤å–”ï¼`;
            } 
            else if (userQ.match(/æ¨è–¦|è²·ä»€éº¼|ç¦®ç‰©/)) {
                reply = `ğŸ <b>è–èª•è³¼ç‰©éˆæ„Ÿï¼š</b><br>1. å¦‚æœæƒ³è²·ç²¾å“ï¼Œæ¨è–¦å» <b>æ–°å…‰ä¸‰è¶Š é‘½çŸ³å¡”</b>ã€‚<br>2. è²·é‹å‹•ç”¨å“ (Nike/Adidas) å¯ä»¥å» <b>é ç™¾ä¿¡ç¾© A13</b> 6Fï¼Œé‚£é‚Šå¾ˆé½Šå…¨ï¼<br>3. æŒ‘ç¾å¦é€äººï¼Œ<b>SOGO å¿ å­é¤¨</b> æ˜¯é¦–é¸ã€‚`;
            }
            else if (userQ.match(/ä½ å¥½|å—¨|hello/)) {
                reply = "æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„å°ˆå±¬è–èª•åŠ©æ‰‹ ğŸ„ è«‹å•ä»Šå¤©æƒ³æ‰¾å“ªå€‹å“ç‰Œï¼Œæˆ–æ˜¯æƒ³æ‰¾å“ªé–“ç™¾è²¨å‘¢ï¼Ÿ";
            }
            else {
                reply = "é€™å€‹å•é¡Œå¤ªæ·±å¥§äº† ğŸ¤” <br>æ‚¨å¯ä»¥è©¦è‘—è¼¸å…¥ã€ŒNike åœ¨å“ªè£¡ï¼Ÿã€æˆ–æ˜¯ã€Œæ¨è–¦å¥½åƒçš„ã€ï¼Œæˆ‘æœƒæ¯”è¼ƒè½å¾—æ‡‚å–”ï¼";
            }

            // é¡¯ç¤º AI å›è¦†
            body.innerHTML += `<div class="msg msg-ai">${reply}</div>`;
            body.scrollTop = body.scrollHeight;

        }, 600);
    }

    // ==========================================
    // 4. UI äº’å‹•åŠŸèƒ½ (æ¨“å±¤åˆ‡æ›ã€è¼ªæ’­ç­‰)
    // ==========================================
    function showFloorPlan(mallId) {
        const mall = mallData.find(m => m.id === mallId);
        if (!mall) return;

        document.getElementById('mainView').style.display = 'none';
        document.getElementById('floorView').style.display = 'block';
        document.getElementById('floorTitle').innerText = `ğŸ„ ${mall.name} æ¨“å±¤å°è¦½`;
        document.getElementById('floorSubtitle').innerText = mall.desc;

        const list = document.getElementById('floorList');
        list.innerHTML = "";
        
        for (const [floor, brands] of Object.entries(mall.floors)) {
            const row = document.createElement('div');
            row.className = 'floor-row';
            row.innerHTML = `
                <div class="floor-num">${floor}</div>
                <div class="floor-brands">
                    ${brands.map(b => `<span class="brand-tag" style="background:#eee; color:#333;">${b}</span>`).join('')}
                </div>
            `;
            list.appendChild(row);
        }
        window.scrollTo(0, 0);
    }

    function closeFloorView() {
        document.getElementById('mainView').style.display = 'block';
        document.getElementById('floorView').style.display = 'none';
    }

    // è¼ªæ’­
    let cIdx = 0;
    setInterval(() => {
        cIdx = (cIdx + 1) % 4;
        document.getElementById('autoCarousel').style.transform = `translateX(-${cIdx * 100}%)`;
    }, 3500);

    // è¼¸å…¥æ¡†æ§åˆ¶
    function checkInput() {
        const val = document.getElementById('brandInput').value;
        document.getElementById('clearBtn').style.display = val ? 'block' : 'none';
    }
    function clearInput() {
        document.getElementById('brandInput').value = '';
        checkInput();
    }
    function toggleAI() {
        const modal = document.getElementById('aiModal');
        modal.style.display = (modal.style.display === 'flex') ? 'none' : 'flex';
    }

</script>
</body>
</html>
