<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ„ è–èª•å°Šæ¦®å“ç‰ŒæŸ¥è©¢ç³»çµ±</title>
    <style>
        /* ======================================= */
        /* åŸºç¤æ¨£å¼ (è–èª•é…è‰²) */
        /* ======================================= */
        body {
            font-family: 'Times New Roman', 'Microsoft JhengHei', serif;
            background-color: #f8f8f8;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 40px 0;
        }
        .container {
            background: white;
            padding: 2.5rem;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 1000px; 
        }
        h2 { 
            text-align: center; 
            color: #B00020;
            font-family: 'Georgia', serif;
            font-size: 2.2rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid #FFD700;
            padding-bottom: 15px;
        }

        /* ======================================= */
        /* è¼ªæ’­æ¨£å¼ */
        /* ======================================= */
        .carousel-section {
            margin-bottom: 3rem;
            overflow: hidden; 
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }
        .carousel-container {
            display: flex;
            transition: transform 0.8s ease-in-out;
            width: 100%;
        }
        .carousel-card {
            min-width: 100%;
            height: 280px;
            flex-shrink: 0;
            background-size: cover;
            background-position: center;
            color: white;
            padding: 40px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.8);
        }
        .carousel-card h4 { margin: 0; font-size: 2.2rem; color: #FFD700; margin-bottom: 10px; }
        .carousel-card p { font-size: 1.1rem; margin: 3px 0; opacity: 0.9; }

        .card-bg-1 { background-image: linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.6)), url('https://picsum.photos/1000/400?christmas'); }
        .card-bg-2 { background-image: linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.6)), url('https://picsum.photos/1000/400?tree'); }
        .card-bg-3 { background-image: linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.6)), url('https://picsum.photos/1000/400?gift'); }
        .card-bg-4 { background-image: linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.6)), url('https://picsum.photos/1000/400?lights'); }

        /* ======================================= */
        /* æœå°‹å€å¡Š */
        /* ======================================= */
        .search-box { 
            background: #fff5f5;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        .search-row {
            display: flex;
            gap: 15px;
            align-items: flex-end;
            flex-wrap: wrap;
        }
        .input-group { flex: 1; min-width: 200px; }
        label { display: block; margin-bottom: 8px; color: #555; font-weight: bold; }
        
        input, select {
            width: 100%; 
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }

        /* æŒ‰éˆ•æ¨£å¼ï¼šåˆ†é–‹å…©å€‹æŒ‰éˆ• */
        .btn-group {
            display: flex;
            gap: 10px;
        }

        /* ä¸€èˆ¬æœå°‹æŒ‰éˆ• (ç´…è‰²) */
        .btn-search {
            padding: 12px 25px;
            background-color: #B00020;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            height: 46px;
            white-space: nowrap;
        }
        .btn-search:hover { background-color: #8C0018; transform: translateY(-2px); }

        /* AI æŒ‰éˆ• (è—è‰²) */
        .btn-ai {
            padding: 12px 25px;
            background-color: #1976D2; /* è—è‰² */
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            height: 46px;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .btn-ai:hover { background-color: #0D47A1; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(25, 118, 210, 0.4); }

        /* ======================================= */
        /* çµæœé¡¯ç¤ºå€ */
        /* ======================================= */
        
        /* AI å°è©±æ¡†æ¨£å¼ */
        .ai-message-box {
            background-color: #E3F2FD;
            border-left: 5px solid #2196F3;
            padding: 15px 20px;
            border-radius: 8px;
            margin-top: 20px;
            margin-bottom: 20px;
            color: #0D47A1;
            font-size: 1.1rem;
            line-height: 1.5;
            display: none; /* é è¨­éš±è— */
            animation: fadeIn 0.5s ease;
        }

        /* å¡ç‰‡å®¹å™¨ */
        .card-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px; 
            margin-top: 25px;
        }
        .card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border-left: 6px solid #FFD700;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
            transition: 0.3s;
            display: flex;
            flex-direction: column;
        }
        .card:hover { transform: translateY(-5px); }
        
        /* é€™è£¡ä¿®æ­£äº†ï¼šæ¨™é¡Œè¦æ˜¯ç™¾è²¨å…¬å¸åå­— */
        .card h4 { margin: 0 0 10px 0; color: #B00020; font-size: 1.3rem; border-bottom: 1px dashed #eee; padding-bottom: 5px; }
        .card p { margin: 6px 0; color: #555; font-size: 1rem; }
        
        /* å“ç‰Œå°æ¨™ç±¤æ¨£å¼ */
        .brand-badge {
            display: inline-block;
            background-color: #B00020;
            color: white;
            padding: 3px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            margin-right: 5px;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .brand-badge.ai-tag { background-color: #1976D2; } /* AI æ¨è–¦çš„ç”¨è—è‰² */

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

<div class="container">
    <h2>âœ¨ å“ç‰Œé–€å¸‚æŸ¥è©¢ & AI åŠ©ç†</h2>

    <div class="carousel-section">
        <div id="autoCarousel" class="carousel-container">
            <div class="carousel-card card-bg-1">
                <h4>é ç™¾ä¿¡ç¾© A13 | è–èª•å¥‡å¹»ä¹‹æ—…</h4>
                <p>ğŸ å„ªæƒ ï¼šé ‚ç´šç²¾å“é™æ™‚æŠ˜æ‰£ï¼Œæ¶ˆè²»æ»¿é¡è´ˆé€è–èª•ç¦®ç›’ï¼</p>
            </div>
            <div class="carousel-card card-bg-2">
                <h4>æ–°å…‰ä¸‰è¶Š é‘½çŸ³å¡” | ç’€ç’¨æ˜Ÿå…‰ç››å®´</h4>
                <p>ğŸ›ï¸ ç‰¹è‰²ï¼šå…¨å°ç¨å®¶è–èª•æ¨¹é€ æ™¯ï¼Œæ‰“å¡é€é£²å“å…Œæ›åˆ¸ï¼</p>
            </div>
            <div class="carousel-card card-bg-3">
                <h4>SOGO å¿ å­é¤¨ | è€¶èª•æš–å¿ƒç»ç¦®</h4>
                <p>ğŸ„ æ¨è–¦ï¼šå¡å‹ç¨äº«ï¼Œç‰¹å®šå“ç‰Œæ¶ˆè²»äº« 9 æŠ˜å„ªæƒ ï¼</p>
            </div>
            <div class="carousel-card card-bg-4">
                <h4>å¾®é¢¨å—å±± | å¥¢è¯è·¨å¹´æ´¾å°</h4>
                <p>ğŸ¥‚ æ¨è–¦ï¼šé ‚æ¨“é…’å§è·¨å¹´æ´»å‹•å¥—ç¥¨é–‹è³£ä¸­ï¼</p>
            </div>
        </div>
    </div>

    <div class="search-box">
        <h3>ğŸ” æŸ¥è©¢åŠŸèƒ½</h3>
        <p style="font-size: 0.9rem; color: #666; margin-top:-10px; margin-bottom: 20px;">
            è¼¸å…¥å“ç‰Œ (å¦‚: Nike) å¯ç›´æ¥æŸ¥è©¢ï¼Œæˆ–è¼¸å…¥å•é¡Œ (å¦‚: æ¨è–¦å¥½åƒçš„) è©¢å• AIã€‚
        </p>

        <div class="search-row">
            <div class="input-group" style="flex: 0 0 150px;">
                <label>é¸æ“‡åŸå¸‚</label>
                <select id="brandCitySelect">
                    <option value="">-- å…¨éƒ¨ --</option>
                    <option value="Taipei">è‡ºåŒ—</option>
                    <option value="NewTaipei">æ–°åŒ—</option>
                    <option value="Keelung">åŸºéš†</option>
                    <option value="Taoyuan">æ¡ƒåœ’</option>
                    <option value="Hsinchu">æ–°ç«¹</option>
                </select>
            </div>
            <div class="input-group">
                <label>è¼¸å…¥å…§å®¹</label>
                <input type="text" id="brandCityInput" placeholder="è¼¸å…¥å“ç‰Œ (Nike) æˆ– å•å• AI (æ™šé¤åƒä»€éº¼)...">
            </div>
            
            <div class="btn-group">
                <button class="btn-search" onclick="doNormalSearch()">ğŸ” æœå°‹å“ç‰Œ</button>
                <button class="btn-ai" onclick="doAiSearch()">ğŸ¤– å• AI</button>
            </div>
        </div>

        <div id="aiResponseBox" class="ai-message-box"></div>

        <div id="resultContainer" class="card-container"></div>
    </div>
</div>

<script>
    // è¨­å®šå¾Œç«¯ä½å€
    const BASE_URL = 'http://localhost:3000';

    // å–å¾— UI å…ƒç´ 
    const inputEl = document.getElementById('brandCityInput');
    const selectEl = document.getElementById('brandCitySelect');
    const resultDiv = document.getElementById('resultContainer');
    const aiBox = document.getElementById('aiResponseBox');

    // ==========================================
    // åŠŸèƒ½ 1ï¼šä¸€èˆ¬æœå°‹ (åªæ‰¾è³‡æ–™åº«)
    // ==========================================
    async function doNormalSearch() {
        const keyword = inputEl.value.trim();
        const city = selectEl.value;

        // æ¸…ç©ºä¸¦éš±è— AI å€å¡Š
        aiBox.style.display = 'none';
        aiBox.innerHTML = '';
        resultDiv.innerHTML = "â³ æ­£åœ¨æœå°‹è³‡æ–™åº«...";

        if (!keyword && !city) {
            alert("è«‹è¼¸å…¥å“ç‰Œåç¨±æˆ–é¸æ“‡åŸå¸‚ï¼");
            resultDiv.innerHTML = "";
            return;
        }

        // æ±ºå®š API è·¯å¾‘
        let apiUrl = '';
        if (keyword && city) {
            apiUrl = `${BASE_URL}/api/search-brand-in-city?city=${city}&brand=${encodeURIComponent(keyword)}`;
        } else if (keyword) {
            apiUrl = `${BASE_URL}/api/brand-location?name=${encodeURIComponent(keyword)}`;
        } else {
            apiUrl = `${BASE_URL}/api/store-by-city?city=${city}`;
        }

        try {
            const res = await fetch(apiUrl);
            const data = await res.json();
            
            // é€™è£¡è¦æ³¨æ„ï¼šAPI å›å‚³æ ¼å¼å¯èƒ½æ˜¯ { success: true, data: [...] } æˆ–ç›´æ¥ [...]
            const list = data.data || data; 

            if (list && list.length > 0) {
                // æ¸²æŸ“å¡ç‰‡ï¼Œå‚³å…¥ keyword ç•¶ä½œæ¨™ç±¤
                renderCards(list, keyword || "ç™¾è²¨å°ˆæ«ƒ");
            } else {
                resultDiv.innerHTML = `<p style="width:100%; text-align:center;">âŒ è³‡æ–™åº«ä¸­æ‰¾ä¸åˆ°é—œæ–¼ã€Œ${keyword}ã€çš„è³‡æ–™ã€‚</p>`;
            }
        } catch (error) {
            console.error(error);
            resultDiv.innerHTML = "<p style='color:red;'>é€£ç·šéŒ¯èª¤ï¼Œè«‹ç¢ºèªå¾Œç«¯ä¼ºæœå™¨å·²å•Ÿå‹•ã€‚</p>";
        }
    }

    // ==========================================
    // åŠŸèƒ½ 2ï¼šAI å•ç­” (å• AI + æ¨è–¦)
    // ==========================================
    async function doAiSearch() {
        const question = inputEl.value.trim();
        if (!question) {
            alert("è«‹è¼¸å…¥å•é¡Œçµ¦ AIï¼Œä¾‹å¦‚ï¼šæˆ‘æƒ³åƒå¥½åƒçš„æ™šé¤");
            return;
        }

        // é¡¯ç¤ºè¼‰å…¥ä¸­
        aiBox.style.display = 'block';
        aiBox.innerHTML = "ğŸ¤– AI æ­£åœ¨æ€è€ƒä¸­... è«‹ç¨å€™...";
        resultDiv.innerHTML = ""; // æ¸…ç©ºèˆŠå¡ç‰‡

        try {
            const res = await fetch(`${BASE_URL}/api/ai-recommend?q=${encodeURIComponent(question)}`);
            const data = await res.json();

            if (data.success) {
                // 1. é¡¯ç¤º AI çš„æ–‡å­—å›ç­”
                const suggestions = data.ai_suggestion ? data.ai_suggestion.join('ã€') : "æ²’æœ‰ç‰¹åˆ¥å»ºè­°";
                aiBox.innerHTML = `
                    <strong>ğŸ¤– AI å°è¦½å“¡å»ºè­°ï¼š</strong><br>
                    æ ¹æ“šæ‚¨çš„éœ€æ±‚ï¼Œæˆ‘æ¨è–¦æ‚¨å¯ä»¥åƒè€ƒï¼š<span style="color:#D81B60; font-weight:bold;">${suggestions}</span>
                `;

                // 2. é¡¯ç¤ºå°æ‡‰çš„è³‡æ–™åº«å¡ç‰‡
                if (data.data && data.data.length > 0) {
                    renderCards(data.data, "AI ç²¾é¸");
                } else {
                    resultDiv.innerHTML = `<p style="width:100%; text-align:center; color:#666;">(è³‡æ–™åº«ä¸­æš«æ™‚æ²’æœ‰é€™äº›æ¨è–¦å“ç‰Œçš„è©³ç´°æ«ƒä½è³‡æ–™)</p>`;
                }
            } else {
                aiBox.innerHTML = "âš ï¸ AI æš«æ™‚ç„¡æ³•å›æ‡‰ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚";
            }

        } catch (error) {
            console.error(error);
            aiBox.innerHTML = "âŒ AI é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥å¾Œç«¯ Key æ˜¯å¦æ­£ç¢ºã€‚";
        }
    }

    // ==========================================
    // å…±ç”¨åŠŸèƒ½ï¼šæ¸²æŸ“å¡ç‰‡ (å«æ¨“å±¤é¡¯ç¤º)
    // ==========================================
    function renderCards(dataList, badgeText) {
        resultDiv.innerHTML = '';
        
        if (!dataList || dataList.length === 0) {
            resultDiv.innerHTML = `<p style="width:100%; text-align:center;">âŒ æ‰¾ä¸åˆ°è³‡æ–™ï¼Œè«‹ç¢ºèªè³‡æ–™åº«æ˜¯å¦æœ‰å»ºç«‹è©²å“ç‰Œçš„æ«ƒä½è³‡æ–™ã€‚</p>`;
            return;
        }

        dataList.forEach(item => {
            const storeName = item.storeName || item.name || "æœªçŸ¥ç™¾è²¨é–€å¸‚"; 
            const address = item.address || "åœ°å€è³‡æ–™å°šæœªå»ºç«‹";
            // è™•ç†æ¨“å±¤é¡¯ç¤ºï¼šå¦‚æœæœ‰è³‡æ–™å°±é¡¯ç¤ºï¼Œæ²’æœ‰å°±å¯« "æœªæ¨™ç¤º"
            const floor = item.floor ? item.floor : "æœªæ¨™ç¤º";
            
            const badgeClass = badgeText === "AI ç²¾é¸" ? "brand-badge ai-tag" : "brand-badge";

            // ğŸ‘‡ å¡ç‰‡ HTML æ¨¡æ¿
            resultDiv.innerHTML += `
                <div class="card">
                    <h4>ğŸ„ ${storeName}</h4>
                    <div>
                        <span class="${badgeClass}">${badgeText}</span>
                    </div>
                    
                    <p style="margin-top:10px; font-weight:bold; color:#E65100;">
                        ğŸ¢ æ¨“å±¤ï¼š${floor}
                    </p>

                    <p style="color:#555;">ğŸ“ åœ°å€ï¼š${address}</p>
                </div>
            `;
        });
    }

    // è‡ªå‹•è¼ªæ’­è…³æœ¬
    document.addEventListener('DOMContentLoaded', () => {
        const carousel = document.getElementById('autoCarousel');
        let index = 0;
        setInterval(() => {
            index = (index + 1) % 4;
            carousel.style.transform = `translateX(-${index * 100}%)`;
        }, 3000);
    });
</script>
</body>
</html>